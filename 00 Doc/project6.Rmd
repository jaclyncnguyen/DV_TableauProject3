---
title: "Project 6: Data Blending"
author: "Jeffrey Zhang and Jaclyn Nguyen"
date: April 22, 2015
output: html_document
---



####__1. Loading of R packages: RCurl, ggplot2, extrafont, jsonlite, dplyr, tidyr, extrafont, jsonlite, reshape2 (R code not shown)__

```{r, include=FALSE}
library(RCurl)
library (ggplot2)
library(extrafont)
library(reshape2)
require(jsonlite)
require(dplyr)
require(tidyr)
require(reshape2)
```

####__2. Data__
Dataset: GOVSPENDING2006(161 obs), GOVSPENDING2007(3024 obs), GOVSPENDING2008(4896 obs), GOVSPENDING2009(3194 obs), CENSUSCOUNTY(3194 obs)

Description of data:
Every year, the US Federal Government allocates money into different areas such as grants, contracts, loans, insurance, direct payments, and others.The US Federal Website breaks the funding into different datasets available publicly based on the category of funding. For this project, we will concentrate on the Federal Spending - Others which include federal spending on items that were originally not budgeted for in the fiscal year. Below describes the types of funding from the federal government in the "Others" category:

A. New assistance action (new program initiatves)

B. Continuation (funding in succeeding budget period which stemmed from prior agreement to fund amount of the current action)

C. Revision (any change in Federal Government's financial obligation or contingent liability in existing assistance transaction amount)

D. Funding adjustment to completed project

[DATA FEEDS AND ARCHIVES DATA DICTIONARY](http://www.usaspending.gov/sites/all/themes/usaspendingv2/Archives_Data_Feeds_Data_Dictionary.pdf) provides additional information on the following data

In order to support further analysis, we are using census data to determine efficacy of the funding.

Oracle SQL Developer: C##CS329E_JCN565

####__3. Analysis and visuals__

#### load data in 
```{r}
source("../01 Data/df_06.R",echo = T)
tbl_df(df_06)
source("../01 Data/df_07.R",echo = T)
tbl_df(df_07)
source("../01 Data/df_08.R",echo = T)
tbl_df(df_08)
```

#### get df_06_fund_by_state and plot
```{r,warning=FALSE}
df_06_state_fund <- df_06 %>% select(PRINCIPAL_PLACE_STATE,FED_FUNDING_AMOUNT_06) %>% filter(PRINCIPAL_PLACE_STATE != '0' && PRINCIPAL_PLACE_STATE != 'null') %>% group_by(PRINCIPAL_PLACE_STATE) %>% summarise(total_fund = sum(FED_FUNDING_AMOUNT_06)) # bug can not get rid of 0

df_06_state_fund %>% ggplot(aes(x=PRINCIPAL_PLACE_STATE, y=total_fund)) + geom_bar(stat="identity",fill="white",colour="darkgreen") + theme(axis.text.x=element_text(angle=90, size=20, vjust=0.5)) + theme(axis.text.x=element_text(size=10, face="bold", vjust=1)) + theme(axis.title.x=element_text(color="forestgreen", vjust=0.35),axis.title.y=element_text(color="cadetblue", vjust=0.35)) + labs(title="Fed_fund_06 VS States",y="Total_fund",x="State")
```

#### then blend df_07 with df_06 linking by PRINCIPAL_PLACE_STATE in df_06 to get 07_06_state_fund_blend (Same as df_06 left join df_07 by PRINCIPAL_PLACE_STATE)
```{r,warning=FALSE}
df_0706_blendBystate <- left_join(df_06,df_07,by='PRINCIPAL_PLACE_STATE') %>% select(PRINCIPAL_PLACE_STATE,FED_FUNDING_AMOUNT_07) %>% filter(PRINCIPAL_PLACE_STATE != '0' && PRINCIPAL_PLACE_STATE != 'null') %>% group_by(PRINCIPAL_PLACE_STATE) %>% summarise(total_fund = sum(FED_FUNDING_AMOUNT_07))
# bug can not get rid of 0 and there is null??

df_0706_blendBystate %>% ggplot(aes(x=PRINCIPAL_PLACE_STATE, y=total_fund)) + geom_bar(stat="identity",fill="white",colour="darkgreen") + theme(axis.text.x=element_text(angle=90, size=20, vjust=0.5)) + theme(axis.text.x=element_text(size=10, face="bold", vjust=1)) + theme(axis.title.x=element_text(color="forestgreen", vjust=0.35),axis.title.y=element_text(color="cadetblue", vjust=0.35)) + labs(title="Fed_fund_0706_blend VS States",y="Total_fund",x="State")

```

#### get df_07_agency_fund and plot
```{r,warning=FALSE}
df_07_agency_fund <- df_07 %>% select(AGENCY_NAME,FED_FUNDING_AMOUNT_07) %>% filter(AGENCY_NAME != '0' && AGENCY_NAME != 'null') %>% group_by(AGENCY_NAME) %>% summarise(total_fund = sum(FED_FUNDING_AMOUNT_07))
df_07_agency_fund %>% ggplot(aes(x=AGENCY_NAME, y=total_fund)) + geom_bar(stat="identity",fill="white",colour="darkgreen") + theme(axis.text.x=element_text(angle=90, size=20, vjust=0.5)) + theme(axis.text.x=element_text(size=10, face="bold", vjust=1)) + theme(axis.title.x=element_text(color="forestgreen", vjust=0.35),axis.title.y=element_text(color="cadetblue", vjust=0.35)) + labs(title="Fed_fund_07 VS Agencies",y="Total_fund",x="Agency")

```

#### then blend df_08 with df_07 linking by agencies in df_07 to get 08_07_agency_fund_blend (Same as df_07 left join df_08 by AGENCY_NAME)
```{r,warning=FALSE}
df_0807_blendByagency <- left_join(df_07,df_08,by='AGENCY_NAME') %>% select(AGENCY_NAME,FED_FUNDING_AMOUNT_07) %>% filter(AGENCY_NAME != '0' && AGENCY_NAME != 'null') %>% group_by(AGENCY_NAME) %>% summarise(total_fund = sum(FED_FUNDING_AMOUNT_07))

df_0807_blendByagency %>% ggplot(aes(x=AGENCY_NAME, y=total_fund)) + geom_bar(stat="identity",fill="white",colour="darkgreen") + theme(axis.text.x=element_text(angle=90, size=20, vjust=0.5)) + theme(axis.text.x=element_text(size=10, face="bold", vjust=1)) + theme(axis.title.x=element_text(color="forestgreen", vjust=0.35),axis.title.y=element_text(color="cadetblue", vjust=0.35)) + labs(title="Fed_fund_0807_blend VS Agencies",y="Total_fund",x="Agency")
```


All data blending was created in Tableau. Below will break down the steps on how we analyzed our data using data blending. 
1. Connecting to datasets in one worksheet.
![](./connect.png)

![](./EditRelation.png)

![](./Relationship.png)